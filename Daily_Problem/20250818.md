# [1504. 统计全 1 子矩形](https://leetcode.cn/problems/count-submatrices-with-all-ones/)

## 解题思路

1. 枚举矩形的左上角
1. 对于每一个确定的矩形左上角$(i, j)$, 在尝试枚举所有满足$mat[i + k][j] = 1 \and mat[i + k - 1][j] = mat[i][j], k > 0, i + k < n$的$k$
1. 在枚举$k$的过程中每次枚举对答案的贡献为$min(f[i + k][j], f[t][j]), t < k$, 其中$f[i][j]$表示以第$i$行的第$j$列方格为起点向右延伸连续且值都是$1$的数组的长度

```cpp
using i32 = int;
using i64 = long long;
using pii = pair<int, int>;
using pll = pair<i64, i64>;
const int mod = 1000000007, mod0 = 998244353;
class Solution {
  public:
    int numSubmat(vector<vector<int>> &mat) {
        i32 n = mat.size(), m = mat[0].size();
        vector<vector<int>> f(n, vector<int>(m + 1));
        for (int i = 0; i < n; ++i) {
            for (int j = m - 1; j >= 0; --j) {
                f[i][j] = mat[i][j] == 1 ? f[i][j + 1] + 1 : 0;
            }
        }

        i32 cnt = 0;
        for (int i = 0; i < n; ++i) {
            for (int j = 0; j < m; ++j) {
                if (mat[i][j] == 0)
                    continue;

                int k = i, mi_len = INT_MAX;
                while (k < n && mat[k][j] == 1) {
                    mi_len = min(mi_len, f[k][j]);
                    cnt += mi_len;
                    ++k;
                }
            }
        }
        return cnt;
    }
};

```

