# [3100. 换水问题 II](https://leetcode.cn/problems/water-bottles-ii/)

## 解题思路

1. 如果选择喝水, 总是喝$numBottles$瓶
1. 假设此时有$emptyBottles$个空瓶子, 找到满足$\frac{n(numExchange + (numExchange + n - 1))}{2}$的最大数$n$, 这个数$n$就是当前能够兑换满水瓶的最大瓶数


## 参考代码

+ 时间复杂度$O(\log{numBottles})$


```java
class Solution {
    public int maxBottlesDrunk(int numBottles, int numExchange) {
        int ans = 0, emptyBottles = 0;
        while (numBottles != 0 || emptyBottles >= numExchange) {
            ans += numBottles;
            emptyBottles += numBottles;
            numBottles = 0;

            int l = 0, r = numExchange;
            while (l < r) {
                int mid = l + r + 1 >> 1;
                int sum = mid * (2 * numExchange + mid - 1) / 2;
                if (sum <= emptyBottles) {
                    l = mid;
                } else {
                    r = mid - 1;
                }
            }

            emptyBottles -= l * (2 * numExchange + l - 1) / 2;
            numBottles += l;
            numExchange += l;
        }
        return ans;
    }
}

```

