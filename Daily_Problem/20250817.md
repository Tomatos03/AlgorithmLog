# [1277. 统计全为 1 的正方形子矩阵](https://leetcode.cn/problems/count-square-submatrices-with-all-ones/)

## 解题思路

1. 预处理二维前缀和数组
2. 枚举正方形的起点$(i, j)$和边长$k$, 终点$(i_0, j_0) = (i + k, j + k)$ 

```cpp
using i32 = int;
using i64 = long long;
using pii = pair<int, int>;
using pll = pair<i64, i64>;
const int mod = 1000000007, mod0 = 998244353;
class Solution {
public:
    int countSquares(vector<vector<int>>& matrix) {
        i32 n = matrix.size(), m = matrix[0].size();
        vector<vector<int>> pre(n + 1, vector<int>(m + 1));
        for (int i = 1; i <= n; ++i) {
            for (int j = 1; j <= m; ++j) {
                pre[i][j] = pre[i - 1][j] + pre[i][j - 1] - pre[i - 1][j - 1] + matrix[i - 1][j - 1];
            }
        }

        int cnt = 0;
        for (int i = 0; i < n; ++i) {
            for (int j = 0; j < m; ++j) {
                for (int k = 0; k < min(n, m); ++k) {
                    if (i + k >= n || j + k >= m)
                        break;

                    int i0 = i + k, j0 = j + k;
                    int sum = pre[i0  + 1][j0 + 1] - pre[i0 + 1][j] - pre[i][j0 + 1] + pre[i][j];
                    cnt += sum == (i0 - i + 1) * (j0 - j + 1);
                }
            }
        }
        return cnt;
    }
};


```

